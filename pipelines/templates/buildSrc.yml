steps:
  - task: Gradle@2
    displayName: Test buildSrc
    inputs:
      cwd: 'buildSrc'
      tasks: 'test'
      gradleWrapperFile: 'gradlew'
      publishJUnitResults: true
      testResultsFiles: 'buildSrc/**/TEST-*.xml'
      testRunTitle: 'buildSrc Tests'
    condition: succeededOrFailed()

  - task: Gradle@2
    displayName: Ktlint buildSrc
    inputs:
      cwd: 'buildSrc'
      tasks: 'ktLintCheck'
      gradleWrapperFile: 'gradlew'
      publishJUnitResults: false
    condition: succeededOrFailed()

  - task: PublishPipelineArtifact@1
    displayName: Publish ktlint buildSrc
    inputs:
      targetPath: 'buildSrc/build/reports/ktlint'
      artifactName: 'ktlint - buildSrc'
    condition: succeededOrFailed()

  - task: Gradle@2
    displayName: Build buildSrc
    inputs:
      cwd: 'buildSrc'
      tasks: 'build'
      gradleWrapperFile: 'gradlew'
      publishJUnitResults: false
    condition: succeededOrFailed()